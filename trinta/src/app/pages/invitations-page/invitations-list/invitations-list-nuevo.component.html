<div class="header-back compact">
  <a routerLink="/">
    <img src="assets/images/pages/back-arrow.png" alt="Volver" width="24" height="24">
  </a>
  <h5 class="mb-0">Reporte de visitas</h5>
</div>

<div class="list-wrap">
  <div
    class="visit-card"
    *ngFor="let invitation of dataSource.data | slice:0:displayCount"
    [class.card-disabled]="!invitation.isActive"
  >
    <!-- Píldora de estado -->
    <div
      class="status-pill"
      [ngClass]="invitation.isUsed ? 'used' : 'unused'"
      aria-label="Estado de invitación"
    >
      <span class="material-symbols-outlined">
        {{ invitation.isUsed ? 'task_alt' : 'radio_button_unchecked' }}
      </span>
      <span class="txt">{{ invitation.isUsed ? 'Usada' : 'Sin usar' }}</span>
    </div>

    <!-- Encabezado compacto -->
    <div class="head">
      <span class="material-symbols-outlined avatar-ico">person</span>
      <div class="who">
        <div class="name">{{ invitation.guestName }}</div>
        <div class="type">Visita</div>
      </div>
    </div>

    <!-- Bloque de info -->
    <div class="info">
      <div class="row">
        <span class="material-symbols-outlined ico tel">call</span>
        <div class="col">
          <div class="label">Teléfono</div>
          <div class="value">{{ invitation.phoneNumber | phoneNumber }}</div>
        </div>
      </div>

      <div class="row">
        <span class="material-symbols-outlined ico date">calendar_month</span>
        <div class="col">
          <div class="label">Fecha</div>
          <div class="value">
            {{ invitation.startTime | date:'d \'de\' MMMM' : undefined : 'es' }}
            –
            {{ invitation.endTime   | date:'d \'de\' MMMM' : undefined : 'es' }}
          </div>
        </div>
      </div>

      <div class="row">
        <span class="material-symbols-outlined ico addr">home_pin</span>
        <div class="col">
          <div class="label">Dirección</div>
          <div class="value">{{ invitation.fullAddress }}</div>
        </div>
      </div>
    </div>

    <!-- Acción (full‑width). Activa ⇒ Compartir, Inactiva ⇒ Duplicar -->
    <div class="actions">
      <button
        *ngIf="invitation.isActive; else duplicateBtn"
        class="full-btn primary"
        type="button"
        (click)="compartir(invitation.token)"
      >
        <span class="material-symbols-outlined">inbox_text_share</span>
        Compartir Visita
      </button>

      <ng-template #duplicateBtn>
        <button
          class="full-btn neutral"
          type="button"
          (click)="onDuplicate(invitation)"
        >
          <span class="material-symbols-outlined">content_copy</span>
          Duplicar Visita
        </button>
      </ng-template>
    </div>
  </div>

  <!-- Ver más -->
  <div class="more" *ngIf="displayCount < dataSource.data.length">
    <button mat-button color="primary" (click)="onViewMore()">Ver más</button>
  </div>
</div>

<!-- FAB para crear nueva invitación    -->
<button
  class="fab"
  type="button"
  aria-label="Nueva invitación"
  (click)="goToCreate()"
>
  <span class="material-symbols-outlined">add</span>
</button>
